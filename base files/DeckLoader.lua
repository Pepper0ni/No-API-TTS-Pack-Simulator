CodeToSet={
 ["PFL"]="Phantasmal Flames",
 ["ME2"]="Phantasmal Flames",
 ["ME1"]="Mega Evolution",
 ["MEG"]="Mega Evolution",
 ["WHT"]="White Flare",
 ["RSV10PT5"]="White Flare",
 ["BLK"]="Black Bolt",
 ["ZSV10PT5"]="Black Bolt",
 ["DRI"]="Destined Rivals",
 ["SV10"]="Destined Rivals",
 ["JTG"]="Journey Together",
 ["SV9"]="Journey Together",
 ["PRE"]="Prismatic Evolutions",
 ["SV8PT5"]="Prismatic Evolutions",
 ["SSP"]="Surging Sparks",
 ["SV8"]="Surging Sparks",
 ["SCR"]="Stellar Crown",
 ["SV7"]="Stellar Crown",
 ["SFA"]="Shrouded Fable",
 ["SV6PT5"]="Shrouded Fable",
 ["TWM"]="Twilight Masqurade",
 ["SV6"]="Twilight Masqurade",
 ["TEF"]="Temporal Forces",
 ["SV5"]="Temporal Forces",
 ["PAF"]="Paldean Fates",
 ["SV4PT5"]="Paldean Fates",
 ["PAR"]="Paradox Rift",
 ["SV4"]="Paradox Rift",
 ["MEW"]="151",
 ["SV3PT5"]="151",
 ["OBF"]="Obsidian Flames",
 ["SV3"]="Obsidian Flames",
 ["PAL"]="Paldea Evolved",
 ["SV2"]="Paldea Evolved",
 ["SVI"]="Scarlet & Violet",
 ["SV1"]="Scarlet & Violet",
 ["SVP"]="Scarlet & Violet Promos",
 ["PR-SV"]="Scarlet & Violet Promos",
 ["CRZGG"]="Crown Zenith",
 ["CRZ-GG"]="Crown Zenith",
 ["CRZ"]="Crown Zenith",
 ["SITTG"]="Silver Tempest",
 ["SIT-TG"]="Silver Tempest",
 ["SIT"]="Silver Tempest",
 ["LORTG"]="Lost Origin",
 ["LOR-TG"]="Lost Origin",
 ["LOR"]="Lost Origin",
 ["MCD22"]="McDonald's Collection 2022",
 ["PGO"]="Pokémon Go",
 ["ASRTG"]="Astral Raidiance",
 ["ASR-TG"]="Astral Raidiance",
 ["ASR"]="Astral Raidiance",
 ["BRSTG"]="Brilliant Stars",
 ["BRS-TG"]="Brilliant Stars",
 ["BRS"]="Brilliant Stars",
 ["FST"]="Fusion Strike",
 ["CEL"]="Celebrations",
 ["MCD21"]="McDonald's Collection 2021",
 ["EVS"]="Evolving Skies",
 ["CRE"]="Chilling Reign",
 ["BST"]="Battle Styles",
 ["SHFSV"]="Shining Fates",
 ["SHF"]="Shining Fates",
 ["VIV"]="Vivid Voltage",
 ["CPA"]="Champion's Path",
 ["FUT20"]="Pokémon Futsal Collection",
 ["DAA"]="Darkness Ablaze",
 ["RCL"]="Rebel Clash",
 ["SSH"]="Sword & Shield",
 ["PR-SW"]="SWSH Black Star Promos",
 ["CEC"]="Cosmic Eclipse",
 ["MCD19"]="McDonald's Collection 2019",
 ["HIFSV"]="Hidden Fates",
 ["sma"]="Hidden Fates",
 ["SMA"]="Hidden Fates",
 ["HIF"]="Hidden Fates",
 ["UNM"]="Unified Minds",
 ["UNB"]="Unbroken Bonds",
 ["DET"]="Detective Pikachu",
 ["TEU"]="Team Up",
 ["LOT"]="Lost Thunder",
 ["MCD18"]="McDonald's Collection 2018",
 ["DRM"]="Dragon Majesty",
 ["CES"]="Celestial Storm",
 ["FLI"]="Forbidden Light",
 ["UPR"]="Ultra Prism",
 ["MCD17"]="McDonald's Collection 2017",
 ["CIN"]="Crimson Invasion",
 ["SLG"]="Shining Legends",
 ["BUS"]="Burning Shadows",
 ["GRI"]="Guardians Rising",
 ["SUM"]="Sun & Moon",
 ["PR-SM"]="SM Black Star Promos",
 ["EVO"]="Evolutions",
 ["MCD16"]="McDonald's Collection 2016",
 ["STS"]="Steam Siege",
 ["FCO"]="Fates Collide",
 ["FAC"]="Fates Collide",
 ["GEN"]="Generations",
 ["BKP"]="BREAKpoint",
 ["MCD15"]="McDonald's Collection 2015",
 ["BKT"]="BREAKthrough",
 ["AOR"]="Ancient Origins",
 ["ROS"]="Roaring Skies",
 ["DCR"]="Double Crisis",
 ["PRC"]="Primal Clash",
 ["PHF"]="Phantom Forces",
 ["FFI"]="Furious Fists",
 ["MCD14"]="McDonald's Collection 2014",
 ["FLF"]="Flashfire",
 ["XY"]="XY",
 ["KSS"]="Kalos Starter Set",
 ["PR-XY"]="XY Black Star Promos",
 ["LTR"]="Legendary Treasures",
 ["PLB"]="Plasma Blast",
 ["PLF"]="Plasma Freeze",
 ["PLS"]="Plasma Storm",
 ["BCR"]="Boundries Crossed",
 ["DRV"]="Dragon Vault",
 ["DRX"]="Dragons Exalted",
 ["MCD12"]="McDonald's Collection 2012",
 ["DEX"]="Dark Explorers",
 ["NXD"]="Next Destinies",
 ["NVI"]="Noble Victories",
 ["EPO"]="Emerging Powers",
 ["MCD11"]="McDonald's Collection 2011",
 ["BLW"]="Black & White",
 ["PR-BLW"]="BW Black Star Promos",
 ["CL"]="Call of Legends",
 ["TM"]="HS—Triumphant",
 ["UD"]="HS—Undaunted",
 ["UL"]="HS—Unleashed",
 ["PR-HS"]="HGSS Black Star Promos",
 ["HS"]="HeartGold & SoulSilver",
 ["RM"]="Pokémon Rumble",
 ["RU1"]="Pokémon Rumble",
 ["AR"]="Arceus",
 ["SV"]="Supreme Victors",
 ["RR"]="Rising Rivals",
 ["P9"]="POP Series 9",
 ["POP9"]="POP Series 9",
 ["pop9"]="POP Series 9",
 ["PL"]="Platinum",
 ["SF"]="Stormfront",
 ["P8"]="POP Series 8",
 ["POP8"]="POP Series 8",
 ["pop8"]="POP Series 8",
 ["LA"]="Legends Awakened",
 ["MD"]="Majestic Dawn",
 ["P7"]="POP Series 7",
 ["POP7"]="POP Series 7",
 ["pop7"]="POP Series 7",
 ["GE"]="Great Encounters",
 ["SW"]="Secret Wonders",
 ["P6"]="POP Series 6",
 ["POP6"]="POP Series 6",
 ["pop6"]="POP Series 6",
 ["MT"]="Mysterious Treasures",
 ["DP"]="Diamond & Pearl",
 ["PR-DPP"]="DP Black Star Promos",
 ["PK"]="Power Keepers",
 ["P5"]="POP Series 5",
 ["POP5"]="POP Series 5",
 ["pop5"]="POP Series 5",
 ["DF"]="Dragon Frontiers",
 ["P4"]="POP Series 4",
 ["POP4"]="POP Series 4",
 ["pop4"]="POP Series 4",
 ["CG"]="Crystal Guardians",
 ["HP"]="Holon Phantoms",
 ["P3"]="POP Series 3",
 ["POP3"]="POP Series 3",
 ["pop3"]="POP Series 3",
 ["TK2M"]="Trainer Kit EX Plusle and Minun",
 ["TK2P"]="Trainer Kit EX Plusle and Minun",
 ["TK2B"]="Trainer Kit EX Plusle and Minun",
 ["TK2A"]="Trainer Kit EX Plusle and Minun",
 ["LM"]="Legend Maker",
 ["DS"]="Delta Species",
 ["P2"]="POP Series 2",
 ["POP2"]="POP Series 2",
 ["pop2"]="POP Series 2",
 ["UF"]="Unseen Forces",
 ["EM"]="Emerald",
 ["DX"]="Deoxys",
 ["TRR"]="Team Rocket Returns",
 ["P1"]="POP Series 1",
 ["POP1"]="POP Series 1",
 ["pop1"]="POP Series 1",
 ["RG"]="FireRed & LeafGreen",
 ["HL"]="Hidden Legends",
 ["TK1O"]="Trainer Kit EX Latias and Latios",
 ["TK1A"]="Trainer Kit EX Latias and Latios",
 ["TK1B"]="Trainer Kit EX Latias and Latios",
 ["MA"]="Team Magma vs Team Aqua",
 ["PR-NP"]="Nintendo Black Star Promos",
 ["DR"]="Dragon",
 ["SS"]="Sandstorm",
 ["RS"]="Ruby & Sapphire",
 ["SK"]="Skyridge",
 ["SKR"]="Skyridge",
 ["AQ"]="Aquapolis",
 ["AQP"]="Aquapolis",
 ["BP"]="Best of Game",
 ["EX"]="Expedition Base Set",
 ["EXP"]="Expedition Base Set",
 ["LC"]="Legendary Collection",
 ["N4"]="Neo Destiny",
 ["N3"]="Neo Revelation",
 ["SI"]="Southern Islands",
 ["SI1"]="Southern Islands",
 ["N2"]="Neo Discovery",
 ["N1"]="Neo Genesis",
 ["G2"]="Gym Challenge",
 ["G1"]="Gym Heroes",
 ["TR"]="Team Rocket",
 ["B2"]="Base Set 2",
 ["FO"]="Fossil",
 ["JU"]="Jungle",
 ["BS"]="Base Set",
 ["PR"]="Wizards Black Star Promos",
 ["WP"]="Wizards Black Star Promos",
}

prefixs={
 ["CRZGG"]="GG",
 ["CRZ-GG"]="GG",
 ["SITTG"]="TG",
 ["LORTG"]="TG",
 ["ASRTG"]="TG",
 ["BRSTG"]="TG",
 ["SIT-TG"]="TG",
 ["LOR-TG"]="TG",
 ["ASR-TG"]="TG",
 ["BRS-TG"]="TG",
 ["SHFSV"]="SV",
 ["PR-SW"]="SWSH",
 ["SWP"]="SWSH",
 ["HIFSV"]="SV",
 ["SMA"]="SV",
 ["sma"]="SV",
 ["PR-SM"]="SM",
 ["PR-XY"]="XY",
 ["PR-BW"]="BW",
 ["PR-HS"]="HGSS",
 ["SMP"]="SM",
 ["XYP"]="XY",
 ["BWP"]="BW",
 ["HSP"]="HGSS",
}

legacyEnergySets={
 {set="BW Energy",
  date="20110425"},
 {set="XY Energy",
  date="20131108"},
 {set="Sun & Moon Energy",
  date="20170203"},
 {set="Sun & Moon Energy",
  date="20190201"},
 {set="Sword & Shield Energy",
  date="20200207"},
 {set="Sword & Shield Energy",
  date="20220225"}
}

legacyEnergy={
 {
  name="Grass Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-BW_Energy-001-grass_energy.jpg"
 },{
  name="Fire Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-BW_Energy-002-fire_energy.jpg"
 },{
  name="Water Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-BW_Energy-003-water_energy.jpg"
 },{
  name="Lightning Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-BW_Energy-004-lightning_energy.jpg"
 },{
  name="Psychic Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-BW_Energy-005-psychic_energy.jpg"
 },{
  name="Fighting Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-BW_Energy-006-fighting_energy.jpg"
 },{
  name="Darkness Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-BW_Energy-007-darkness_energy.jpg"
 },{
  name="Metal Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-BW_Energy-008-metal_energy.jpg"
 },{
  name="Grass Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-XY_Energy-001-grass_energy.jpg"
 },{
  name="Fire Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-XY_Energy-002-fire_energy.jpg"
 },{
  name="Water Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-XY_Energy-003-water_energy.jpg"
 },{
  name="Lightning Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-XY_Energy-004-lightning_energy.jpg"
 },{
  name="Psychic Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-XY_Energy-005-psychic_energy.jpg"
 },{
  name="Fighting Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-XY_Energy-006-fighting_energy.jpg"
 },{
  name="Darkness Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-XY_Energy-007-darkness_energy.jpg"
 },{
  name="Metal Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-XY_Energy-008-metal_energy.jpg"
 },{
  name="Fairy Energy",
  image="https://pkmncards.com/wp-content/uploads/en_US-XY_Energy-009-fairy_energy.jpg"
 },{
  name="Grass Energy",
  steamUrl="1826780185929832402/5FE64CA2668E4A91ED64DD05E59D74CF958EADEB"
 },{
  name="Fire Energy",
  steamUrl="1826780185929832714/8853045CD1F634E848895927164FB5A522E39CEC"
 },{
  name="Water Energy",
  steamUrl="1826780185929832999/7B1E59BB866F9CBD81888416808101B3519CB8C9"
 },{
  name="Lightning Energy",
  steamUrl="1826780185929833512/90A9B8E6DA4C2F28FB267D97D7213D465DBF3186"
 },{
  name="Psychic Energy",
  steamUrl="1826780185929834195/8BB262C2D63EA80E6C04F09136CCD043D75EC2BE"
 },{
  name="Fighting Energy",
  steamUrl="1826780185929833839/B5C3FFB69E5180AEF58AABC6B648419A973AD1E5"
 },{
  name="Darkness Energy",
  steamUrl="1826780185929834635/F274B54CA2718B0CDADEA30355C2CA435E8A4E1A"
 },{
  name="Metal Energy",
  steamUrl="1826780185929834975/1892F7B06D18C0B1AB7F4FFEC69FF52239D21B5F"
 },{
  name="Fairy Energy",
  steamUrl="1826780185929835278/E2A48B5AD439570D5613491267C9B649055ACA4F"
 },{
  name="Grass Energy",
  steamUrl="1832405798628986164/8DAE81347A07897ACD085586A20D95CF2598E347"
 },{
  name="Fire Energy",
  steamUrl="1832405798628987149/3187D01AA63593BAD2A13058C9A64986771B83D5"
 },{
  name="Water Energy",
  steamUrl="1832405798628988741/04A35BDD099EBE7E18DBB9D7E7AB999D5BA66D9E"
 },{
  name="Lightning Energy",
  steamUrl="1832405798628989261/5967BCC4EB91584ABEB1680F1CF83B70302EAF52"
 },{
  name="Psychic Energy",
  steamUrl="1832405798628989709/D12DB2BE41A2185C11D87062EC08E285969F82A5"
 },{
  name="Fighting Energy",
  steamUrl="1832405798628991233/69EB109A4FE5D47D1B58FB59EC2517A30DB1DA20"
 },{
  name="Darkness Energy",
  steamUrl="1832405798628991928/8B177CCA848C1747B3790053958FAA79F3E0314B"
 },{
  name="Metal Energy",
  steamUrl="1832405798628992609/CC82A01EDC098ABEDA1376083E17D028F387A0A7"
 },{
  name="Fairy Energy",
  steamUrl="1832405798628993182/0CBE5BDF044B22B16510A8699F3B00CAC229C14C"
 },{
  name="Grass Energy",
  steamUrl="1832405798628838691/9F72772F0F21C4F6455D35CDDA7C0387D2C344CD"
 },{
  name="Fire Energy",
  steamUrl="1832405798628839998/882EB1317DC1D12FF4994221E57FE41B4ECF8D70"
 },{
  name="Water Energy",
  steamUrl="1832405798628840522/64FB79B3C680D7B11BAEFD367E03115243508AC2"
 },{
  name="Lightning Energy",
  steamUrl="1832405798628842568/67A8211D36AE2FF603C7A4B775C894EA25EA9155"
 },{
  name="Psychic Energy",
  steamUrl="1832405798628843075/407375AECC10AD4150F2C70FBB63A0BAC0A9AE05"
 },{
  name="Fighting Energy",
  steamUrl="1832405798628843991/B1DDC67C84E0E0E1527F85058DCDF038DB9D8663"
 },{
  name="Darkness Energy",
  steamUrl="1832405798628844608/70C62511CA9F2631D1E1DE691F4099A8102EE7EC"
 },{
  name="Metal Energy",
  steamUrl="1832405798628845093/EC66EEED31A9BAB8CCEDBB7152B0B4EC4C9D6F55"
 },{
  name="Fairy Energy",
  steamUrl="1832405798628845735/B64816866B1D0B67963CE2E9114F77A2E9C3BD2E",
 },{
  name="Grass Energy",
  image="https://images.pokemontcg.io/swsh12pt5/152_hires.png?count=152"
 },{
  name="Fire Energy",
  image="https://images.pokemontcg.io/swsh12pt5/153_hires.png?count=153"
 },{
  name="Water Energy",
  image="https://images.pokemontcg.io/swsh12pt5/154_hires.png?count=154"
 },{
  name="Lightning Energy",
  image="https://images.pokemontcg.io/swsh12pt5/155_hires.png?count=155"
 },{
  name="Psychic Energy",
  image="https://images.pokemontcg.io/swsh12pt5/156_hires.png?count=156"
 },{
  name="Fighting Energy",
  image="https://images.pokemontcg.io/swsh12pt5/157_hires.png?count=157"
 },{
  name="Darkness Energy",
  image="https://images.pokemontcg.io/swsh12pt5/158_hires.png?count=158"
 },{
  name="Metal Energy",
  image="https://images.pokemontcg.io/swsh12pt5/159_hires.png?count=159"
 },{
  name="Fairy Energy",
  steamUrl="5938629525077704809/AA601036EC69849338EA983AF7061CB66798AC22"
 },
}

SVE={
 ["1"]={
  name="Basic Grass Energy",
  date="20230331"
 },
 ["2"]={
  name="Basic Fire Energy",
  date="20230331"
 },
 ["3"]={
  name="Basic Water Energy",
  date="20230331"
 },
 ["4"]={
  name="Basic Lightning Energy",
  date="20230331"
 },
 ["5"]={
  name="Basic Psychic Energy",
  date="20230331"
 },
 ["6"]={
  name="Basic Fighting Energy",
  date="20230331"
 },
 ["7"]={
  name="Basic Darkness Energy",
  date="20230331"
 },
 ["8"]={
  name="Basic Metal Energy",
  date="20230331"
 },
 ["Y1"]={
  name="Basic Fairy Energy",
  steamUrl="5938629525077705258/59388EFF16D70C1BFED9924ADFFAFD252E05F5A5",
  date="20230331",
  ID=19837
 },
 ["9"]={
  name="Basic Grass Energy",
  date="20240913"
 },
 ["10"]={
  name="Basic Fire Energy",
  date="20240913"
 },
 ["11"]={
  name="Basic Water Energy",
  date="20240913"
 },
 ["12"]={
  name="Basic Lightning Energy",
  date="20240913"
 },
 ["13"]={
  name="Basic Psychic Energy",
  date="20240913"
 },
 ["14"]={
  name="Basic Fighting Energy",
  date="20240913"
 },
 ["15"]={
  name="Basic Darkness Energy",
  date="20240913"
 },
 ["16"]={
  name="Basic Metal Energy",
  date="20240913"
 },
 ["17"]={
  name="Basic Grass Energy",
  date="20250718",
  steamUrl="10601430051692179640/F37C918A7F9D64B17787AB6787C460CA0C6371C7"
 },
 ["18"]={
  name="Basic Fire Energy",
  date="20250718",
  steamUrl="14704563349234798281/389F47D8B3BFD509AD9F17C0277E9FC2B15DD5E4"
 },
 ["19"]={
  name="Basic Water Energy",
  date="20250718",
  steamUrl="10554681915527871175/523CA3054B8DEE02F8CC5ED32B82A2786BC3B372"
 },
 ["20"]={
  name="Basic Lightning Energy",
  date="20250718",
  steamUrl="12798794065975132397/6DA459CADC2EA358CA3878307675D4D2B6D06105"
 },
 ["21"]={
  name="Basic Psychic Energy",
  date="20250718",
  steamUrl="12818908135999904365/0545D563DBFE5D0020870207B99EF3A018EF09C2"
 },
 ["22"]={
  name="Basic Fighting Energy",
  date="20250718",
  steamUrl="14138223394909599226/1024C425BA40C52BC2C6D7492D6D75253397754B"
 },
 ["23"]={
  name="Basic Darkness Energy",
  date="20250718",
  steamUrl="9352230114368524077/19711A7DE020F43A4BB512E9857DE87E6D3CABC5"
 },
 ["24"]={
  name="Basic Metal Energy",
  date="20250718",
  steamUrl="12270231680019945383/E20499B7C3E854957F3ECE0638A7C61EAA9474E2"
 }
}

MEE={
 ["1"]={
  name="Basic Grass Energy",
  date="20250926",
  image="https://pkmncards.com/wp-content/uploads/mee_en_001_std.jpg"
 },
 ["2"]={
  name="Basic Fire Energy",
  date="20250926",
  image="https://pkmncards.com/wp-content/uploads/mee_en_002_std.jpg"
 },
 ["3"]={
  name="Basic Water Energy",
  date="20250926",
  image="https://pkmncards.com/wp-content/uploads/mee_en_003_std.jpg"
 },
 ["4"]={
  name="Basic Lightning Energy",
  date="20250926",
  image="https://pkmncards.com/wp-content/uploads/mee_en_004_std.jpg"
 },
 ["5"]={
  name="Basic Psychic Energy",
  date="20250926",
  image="https://pkmncards.com/wp-content/uploads/mee_en_005_std.jpg"
 },
 ["6"]={
  name="Basic Fighting Energy",
  date="20250926",
  image="https://pkmncards.com/wp-content/uploads/mee_en_006_std.jpg"
 },
 ["7"]={
  name="Basic Darkness Energy",
  date="20250926",
  image="https://pkmncards.com/wp-content/uploads/mee_en_007_std.jpg"
 },
 ["8"]={
  name="Basic Metal Energy",
  date="20250926",
  image="https://pkmncards.com/wp-content/uploads/mee_en_008_std.jpg"
 }
}

energyToNum={
  Grass=1,
  Fire=2,
  Water=3,
  Lightning=4,
  Psychic=5,
  Fighting=6,
  Darkness=7,
  Metal=8,
  Fairy=9,
}

dumbNumtoEnergy={"Darkness","Fairy","Fighting","Fire","Grass","Lightning","Metal","Psychic","Water"}

letterToEnergy={
 G="Grass",
 R="Fire",
 W="Water",
 L="Lightning",
 P="Psychic",
 F="Fighting",
 D="Darkness",
 M="Metal",
 Y="Fairy"
}

normalSetToEnergy={
 SUM=17,
 TEU=26,
 SSH=35,
 BRS=44
}

dumbEnergySets={
 BLWEnergy=0,
 XYEnergy=8
}

energySets={
 SMEnergy=17,
 SWSHEnergy=35
}

APIminDigits={
 ["XYP"]=2,
 ["PR-XY"]=2,
 ["SMP"]=2,
 ["PR-SM"]=2,
 ["SWSHP"]=3,
 ["PR-SW"]=3,
 ["SHFSV"]=3,
 ["CRZGG"]=2,
 ["CRZ-GG"]=2,
 ["SITTG"]=2,
 ["LORTG"]=2,
 ["ASRTG"]=2,
 ["BRSTG"]=2,
 ["SIT-TG"]=2,
 ["LOR-TG"]=2,
 ["ASR-TG"]=2,
 ["BRS-TG"]=2,
 ["SVP"]=3,
 ["PR-SV"]=3,
}

CELNameToID={
Claydol="CC16",
Kaorine="CC16",
Lepumentas="CC16",
Venusaur="CC3",
Florizarre="CC3",
Bisaflor="CC3",
Venossauro="CC3",
["Rocket!"]="CC6",
Rocket="CC7",
Zapdos="CC7",
}

overflows={
 HIF={"HIFSV",69},
 SHF={"SHFSV",73},
 BRS={"BRSTG",186},
 ASR={"ASRTG",216},
 LOR={"LORTG",217},
 SIT={"SITTG",215},
 CRZ={"CRZGG",160},
}

lastSearchText=false
lastSearchCount=false
lastSearchTotal=false
curPos=0
curStart=1
quantity={}
energy={}
cardNum=0
spawnData={}
curSet=16

function onLoad(state)
 local strValue=""
 if not(not state or state=="")then
  state=json.parse(state)
  strValue=state.value or""
  curSet=state.curSet or 16
 end
 params={
  function_owner=self,
  position={0,0.1,3.3},
  tooltip="Enter the term to search here.",
  label='Enter Deck List',
  font_size=70,
  width=1500,
  height=3200,
  alignment=3,
  input_function="saveData",
  font_color={0,0,0},
  scale={0.75,1,0.5},
  value=strValue,
 }
 self.createInput(params)
 setUpButtons()
end

function saveData()
 self.script_state=json.serialize({value=self.getInputs()[1].value,curSet=curSet})
end

function setUpButtons()
 self.clearButtons()
 local params={
  function_owner=self,
  font_size=197,
  width=1500,
  height=220,
  scale={0.75,1,0.5},
  color={1,1,1},
 }
 butWrapper(params,{0,0.1,1.2},'Get Deck',"Load this decklist as a deck",'loadDecklist')
end

function butWrapper(params,pos,label,tool,func)
 params.position=pos
 params.label=label
 params.tooltip=tool
 params.click_function=func
 self.createButton(params)
end

function addQuantity(set,cardNum,quant)
 if not quantity[set] then
  quantity[set]={}
 end
 quantity[set][cardNum]=quant+(quantity[set][cardNum]or 0)
 cardsNum=cardsNum+quant
end

function loadDecklist(obj,color,alt)
 quantity={}
 energy={}
 cardsNum=0
 local deckText=self.getInputs()[1].value
 for line in string.gmatch(deckText,"[^\r\n]+")do
  local words={}
  for c in string.gmatch(line,"[%d%a!?-]+")do
   words[#words+1]=c
  end
  local wordsNum=tonumber(words[1])
  if wordsNum then
   if words[#words]=="PH"then
    words[#words]=nil
   end
   local setName=words[#words-1]
   local cardNum=words[#words]
   if overflows[setName]and tonumber(cardNum)>overflows[setName][2] then
    cardNum=tostring(tonumber(cardNum)-overflows[setName][2])
    setName=overflows[setName][1]
   elseif setName=="CEL"then
    local monName=words[#words-2]
    if cardNum=="15"then
     if monName!="Lunala"then cardNum=CELNameToID[monName] end
    elseif cardNum=="2"then
     if monName!="Reshiram"then cardNum="CC"..cardNum end
    elseif cardNum=="4"then
     if monName!="Palkia"then cardNum="CC"..cardNum end
    elseif cardNum=="9"then
     if monName!="VMAX"then cardNum="CC"..cardNum end
    elseif cardNum=="24"then
     if monName!="Research"then cardNum="CC"..cardNum end
    end
   elseif setName=="CEL-C"or setName=="N/A"or setName=="CELC"or setName=="CEL-CC"
    then
    setName="CEL"
    cardNum="CC"..cardNum
   end
   if cardNum=="Energy" then
    addQuantity("LegacyEnergy",energyToNum[setName]+8,wordsNum)
   elseif CodeToSet[setName]then
    if letterToEnergy[cardNum]and normalSetToEnergy[setName]then
     addQuantity("LegacyEnergy",energyToNum[letterToEnergy[cardNum]]+normalSetToEnergy[setName],wordsNum)
    else
     local boxName=CodeToSet[setName]
     if APIminDigits[setName]then
      local prefix=string.match(cardNum,"^%a+")or""
      cardNum=string.gsub(cardNum,"%a","")
      local digits=APIminDigits[setName]
      if #cardNum>digits then
       cardNum=string.gsub(cardNum,"^0+","",1)
      elseif #cardNum<digits then
       while #cardNum<digits do cardNum="0"..cardNum end
      end
      cardNum=prefix..cardNum
     end
     if prefixs[setName]and not startsWith(cardNum,prefixs[setName]) then
      cardNum=prefixs[setName]..cardNum
     end
     addQuantity(boxName,cardNum,wordsNum)
    end
   elseif energySets[setName]then
    addQuantity("LegacyEnergy",cardNum+energySets[setName],wordsNum)
   elseif dumbEnergySets[setName]then
    addQuantity("LegacyEnergy",dumbEnergySets[setName]+ energyToNum[dumbNumtoEnergy[tonumber(cardNum)]],wordsNum)
   elseif setName=="Energy"then
    addQuantity("LegacyEnergy",cardNum,wordsNum)
   elseif setName=="HGSSEnergy"then
    addQuantity("HGSSEnergy",cardNum,wordsNum)
   elseif setName=="SVE"then
    addQuantity("Scarlet & Violet Energy",cardNum,wordsNum)
   elseif setName=="MEE"then
    addQuantity("Mega Evolution Energy",cardNum,wordsNum)
   end
  end
 end
 if cardsNum>0 then
  getDeck(color)
 end
end

function setTableCheck(trySet,eType)
 if energyTable[trySet].types[eType]then
  return trySet
 end
 return 16
end

function getObjectByDesc(desc)
 for _,obj in ipairs(getObjects())do
  if obj.getDescription()==desc then
   return obj
  end
 end
end

cardData={}
packData={}
DeckID=0
setID="error"
setName="ERROR"

function getDeck(color)
 local spawnPos=self.positionToWorld({0,2,0})
 packData=getDeckData(spawnPos,self.getRotation(),false)
 for set,cards in pairs(quantity)do
  setName=set
  if set=="LegacyEnergy"then
   for num,quant in pairs(cards)do
    local card=legacyEnergy[tonumber(num)]
    card.ID=19759+tonumber(num)
    card.GMN="80000000"
    card.typ="500"
    card.num=""
    card.date=legacyEnergySets[math.floor(num/9)+1].date
    card.setName=legacyEnergySets[math.floor(num/9)+1].set
    for c=1,quant do
     addCard(tostring(num),card)
    end
   end
  elseif set=="Scarlet & Violet Energy"then
   for num,quant in pairs(cards)do
    local card=SVE[num]
    DeckID=19812
    setID="sve"
    card.GMN="80000000"
    card.typ="500"
    for c=1,quant do
     addCard(tostring(num),card)
    end
   end
  elseif set=="Mega Evolution Energy"then
   for num,quant in pairs(cards)do
    local card=MEE[num]
    setID="mee"
    DeckID=19837
    card.GMN="80000000"
    card.typ="500"
    for c=1,quant do
     addCard(tostring(num),card)
    end
   end
  else
   box=getObjectByDesc(set)
   cardData=box.GetTable("cardData")
   DeckID=box.GetVar("DeckID")
   setID=box.GetVar("setID")
   subSetID=box.GetVar("subSetID")
   subSetPre=box.GetVar("subSetPre")
   subSetName=box.GetVar("subSetName")
   date=box.GetVar("date")
   for num,quant in pairs(cards)do
    local card=cardData[num] or cardData[tonumber(num)]
    if card then
     for c=1,quant do
      addCard(tostring(num),card)
     end
    else
     broadcastToColor("Card "..setName.." "..tostring(num).." Not Found!",color,{1,0,0})
    end
   end
  end
 end
 local deck=spawnObjectData({data=packData})
end

function getDeckData(spawnPos,cardRot,hands)
 return {Name="Deck",
  Transform={posX=spawnPos[1],posY=spawnPos[2],posZ=spawnPos[3],rotX=cardRot[1],rotY=cardRot[2],rotZ=cardRot[3],scaleX=1,scaleY=1,scaleZ=1},
  Hands=hands,
  DeckIDs={},
  CustomDeck={},
  ContainedObjects={}
 }
end

function getTrueNumber(num,card)
 if card.num then return card.num end
 if startsWith(num,"E")then return num:sub(2)else return num end
end

function removeLeadingZeros(num)
 if tonumber(num)then return string.format("%u", num)else return num end
end

function getDeckID(num,card)
 return card.ID or DeckID+tonumber(getTrueNumber(num,card))
end

function addCard(num,card)
 packData.DeckIDs[#packData.DeckIDs+1]=getDeckID(num,card)*100
 packData.CustomDeck[getDeckID(num,card)]=getCustomData(getTrueNumber(num,card),card)
 packData.ContainedObjects[#packData.ContainedObjects+1]=getCardTable(packData.Transform,num,card)
end

function getCardTable(trans,num,card)
 local des=card.setName
 if not des then
  if subSetID and startsWith(num,subSetPre)then
   des=subSetName
  else
   des=setName
  end
 end
 if card.num!=""then
  des=des.." #"..getTrueNumber(num,card)
 end
 if card.rar then
  des=des.." "..card.rar
 end
 return{Name="CardCustom",
 Transform=trans,
 Nickname=card.name,
 Description=des,
 GMNotes=card.GMN,
 Memo=(card.date or date)..buildCardNumber(num,3),
 CardID=getDeckID(num,card)*100,
 CustomDeck={[getDeckID(num,card)]=getCustomData(num,card)},
 LuaScriptState=card.typ
}
end

function getCustomData(num,card)
 local image=card.image
 if not image then
  if card.steamUrl then
   image=getSteamUrl(card.steamUrl)
  else
   local ID=setID
   if subSetID and startsWith(num,subSetPre) then
    ID=subSetID
   end
   image="https://images.pokemontcg.io/"..ID.."/"..removeLeadingZeros(getTrueNumber(num,card)).."_hires.png?count="..buildCardNumber(num,1)
  end
 end
 return{FaceURL=image,
  BackURL=card.back or"https://steamusercontent-a.akamaihd.net/ugc/809997459557414686/9ABD9158841F1167D295FD1295D7A597E03A7487/",
  NumWidth=1,
  NumHeight=1,
  BackIsHidden=true
 }
end

function buildCardNumber(cardNum,minDigit)
 if cardNum then
  local numOnly=string.gsub(cardNum,"[^%d]","")
  if numOnly~=cardNum then
   local finalNum=(tonumber(numOnly)or 0)+500
   for c in cardNum:gmatch"[^%d]" do
    if c=="?"then c="}"end
    if c=="!"then c="{"end
    finalNum=string.byte(c)-65+finalNum
   end
   cardNum=tostring(finalNum)
  end
 else
  cardNum="0"
 end
 while #cardNum<minDigit do cardNum="0"..cardNum end
 return cardNum
end

function sortByPoke(a,b)
 local aNotes=tonumber(a.GMNotes)
 local bNotes=tonumber(b.GMNotes)
 if #a.GMNotes==6 then aNotes=aNotes*100 end
 if #b.GMNotes==6 then bNotes=bNotes*100 end
 if aNotes and bNotes and aNotes~=bNotes then
  return aNotes<bNotes
 elseif a.Nickname~=b.Nickname then
  return a.Nickname<b.Nickname
 else
  local aMemo=tonumber(a.Memo)
  local bMemo=tonumber(b.Memo)
  if aMemo and bMemo then return aMemo<bMemo end
 end
 return a.CardID<b.CardID
end

function getSteamUrl(url)
 if url then return"https://steamusercontent-a.akamaihd.net/ugc/"..url.."/"end
end

function startsWith(input,prefix)
 if not prefix then return false end
 return string.sub(input,1,#prefix)==prefix
end

function DummyFunc()
end
